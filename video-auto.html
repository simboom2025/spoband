<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SPOBAND – 영상(자동)</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .empty { text-align:center; padding:24px; border:1px dashed var(--border); border-radius:12px; background:#fff; color:var(--muted); }
    .filters { display:flex; gap:8px; flex-wrap:wrap; }
    .filter-btn { padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:#fff; cursor:pointer; font-weight:700; }
    .filter-btn.active { background:var(--brand); color:#fff; border-color:var(--brand); }
    .video-embed { border-radius:14px; overflow:hidden; border:1px solid var(--border); aspect-ratio:16/9; }
    .subtle { font-size:13px; color:var(--muted); }
  </style>
</head>
<body>
  <!-- 상단 네비 -->
  <div class="nav">
    <div class="nav-inner">
      <a class="logo" href="index.html">SPOBAND</a>
      <div>
        <a class="link" href="index.html">메인</a>
        <a class="link" href="personal.html">개인</a>
        <a class="link" href="group.html">단체</a>
        <a class="link" href="shop.html">쇼핑(수동)</a>
        <a class="link" href="shop-auto.html">쇼핑(자동)</a>
        <a class="link" href="videos.html">영상(수동)</a>
        <a class="link" href="videos-auto.html"><b>영상(자동)</b></a>
        <a class="link" href="admin.html">관리</a>
      </div>
    </div>
  </div>

  <!-- 본문 -->
  <div class="wrap">
    <div class="hero">
      <h1>영상 (자동 생성)</h1>
      <p class="lead">관리자에서 입력한 영상 데이터를 자동으로 불러옵니다. 같은 브라우저의 localStorage 기준입니다.</p>
      <a href="admin.html" class="btn primary">관리자에서 영상 추가하기</a>
      <a href="#" id="refreshBtn" class="btn">새로고침</a>
    </div>

    <!-- 필터 -->
    <div class="card" style="margin:18px 0;">
      <div class="filters" id="filters">
        <!-- 동적 카테고리 버튼 -->
      </div>
      <p class="subtle" id="countInfo" style="margin-top:8px;"></p>
    </div>

    <!-- 리스트 -->
    <div id="videoList" class="grid col2">
      <!-- 동적 렌더링 -->
    </div>

    <div class="card" style="margin-top:20px;">
      <p class="subtle">※ YouTube 임베드는 <code>https://www.youtube.com/embed/비디오ID</code> 형식일 때 미리보기가 보입니다. 다른 형식(URL)일 땐 “원본 열기” 링크만 표시돼요.</p>
    </div>
  </div>

  <div class="footer">© SPOBAND</div>

  <script>
    // ====== admin.html과 동일 키 ======
    const K_VIDEOS = 'spb_videos';

    const store = { get(k,d){ try{ return JSON.parse(localStorage.getItem(k)) ?? d; }catch(e){ return d; } } };
    const $ = (sel) => document.querySelector(sel);

    const state = {
      all: [],
      category: '전체'
    };

    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
    function escapeAttr(s){ return String(s||'').replace(/"/g,'&quot;'); }

    function load(){
      state.all = store.get(K_VIDEOS, []);
      buildFilters();
      render();
    }

    function buildFilters(){
      const cats = Array.from(new Set(state.all.map(v => (v.category||'').trim()).filter(Boolean)));
      const box = document.getElementById('filters'); box.innerHTML = '';
      const makeBtn = (name) => {
        const b = document.createElement('button');
        b.className = 'filter-btn' + (state.category===name ? ' active' : '');
        b.textContent = name;
        b.addEventListener('click', ()=>{ state.category = name; buildFilters(); render(); });
        return b;
      };
      box.appendChild(makeBtn('전체'));
      cats.forEach(c => box.appendChild(makeBtn(c)));
    }

    function render(){
      const listEl = document.getElementById('videoList');
      listEl.innerHTML = '';

      const list = state.category==='전체'
        ? state.all
        : state.all.filter(v => (v.category||'').trim() === state.category);

      document.getElementById('countInfo').textContent =
        `${state.category} 카테고리: ${list.length}개 / 전체 ${state.all.length}개`;

      if(state.all.length === 0){
        listEl.outerHTML = `<div id="videoList" class="empty">아직 영상이 없습니다. 관리자에서 추가해 주세요.</div>`;
        return;
      }

      if(list.length === 0){
        listEl.outerHTML = `<div id="videoList" class="empty">선택한 카테고리에 영상이 없습니다.</div>`;
        return;
      }

      list.forEach(v => {
        const card = document.createElement('div');
        card.className = 'card';
        const url = (v.url||'').startsWith('https://www.youtube.com/embed/') ? v.url : '';
        card.innerHTML = `
          <h3>${escapeHtml(v.title)} ${v.category? `<span class="badge">${escapeHtml(v.category)}</span>`:''}</h3>
          <p>${escapeHtml(v.desc || '')}</p>
          ${url
            ? `<div class="video-embed"><iframe src="${escapeAttr(url)}" allowfullscreen style="width:100%;height:100%;border:0;"></iframe></div>`
            : `<p class="subtle">임베드 URL 형식이 아니에요. <a href="${escapeAttr(v.url||'#')}" target="_blank">원본 열기</a></p>`
          }
        `;
        listEl.appendChild(card);
      });
    }

    document.getElementById('refreshBtn').addEventListener('click', e => { e.preventDefault(); load(); });
    load();
  </script>
</body>
</html>
