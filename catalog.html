<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SPOBAND – 카탈로그(자동 생성)</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .empty { color: var(--muted); text-align:center; padding:24px; border:1px dashed var(--border); border-radius:12px; background:#fff; }
    .price { font-weight:800; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid var(--border); font-size:12px; margin-left:6px; }
    .subtle { font-size:13px; color:var(--muted); }
    .video-embed { border-radius:14px; overflow:hidden; border:1px solid var(--border); }
    .section-head { display:flex; align-items:center; justify-content:space-between; gap:10px; }
  </style>
</head>
<body>
  <!-- 상단 네비 -->
  <div class="nav">
    <div class="nav-inner">
      <a class="logo" href="index.html">SPOBAND</a>
      <div>
        <a class="link" href="index.html">메인</a>
        <a class="link" href="shop.html">쇼핑(수동)</a>
        <a class="link" href="videos.html">영상(수동)</a>
        <a class="link" href="catalog.html"><b>카탈로그(자동)</b></a>
        <a class="link" href="admin.html">관리</a>
      </div>
    </div>
  </div>

  <!-- 본문 -->
  <div class="wrap">
    <div class="hero">
      <h1>카탈로그 (자동 생성)</h1>
      <p class="lead">관리자에서 입력한 <b>상품</b>과 <b>영상</b>을 자동으로 보여줍니다. 현재는 이 브라우저의 localStorage 기준입니다.</p>
      <a class="btn" href="admin.html">관리자에서 데이터 입력하기</a>
      <a class="btn" href="#" id="refreshBtn">새로고침</a>
    </div>

    <!-- 상품 섹션 -->
    <div class="section-head" style="margin:22px 0 12px;">
      <h2 style="margin:0;">상품</h2>
      <span class="subtle" id="prodCount">0개</span>
    </div>
    <div id="productList" class="grid col3">
      <!-- 동적 렌더링 -->
    </div>

    <!-- 영상 섹션 -->
    <div class="section-head" style="margin:26px 0 12px;">
      <h2 style="margin:0;">영상</h2>
      <span class="subtle" id="videoCount">0개</span>
    </div>
    <div id="videoList" class="grid col2">
      <!-- 동적 렌더링 -->
    </div>

    <div class="card" style="margin-top:20px;">
      <p class="subtle">※ 이 페이지는 학습용 프런트 전용 자동 생성입니다. 실제 서비스에서는 DB(예: Firebase/Supabase) 또는 정적 빌드 스크립트로 전 사이트에 동일하게 반영하도록 확장하세요.</p>
    </div>
  </div>

  <div class="footer">© SPOBAND</div>

  <script>
    // ====== admin.html 에서 사용한 키와 동일하게 유지 ======
    const K_PRODUCTS = 'spb_products';
    const K_VIDEOS   = 'spb_videos';

    const store = {
      get(key, def){ try{ return JSON.parse(localStorage.getItem(key)) ?? def; }catch(e){ return def; } }
    };

    function formatPrice(n){
      const num = Number(n||0);
      return isNaN(num) ? '-' : num.toLocaleString() + '원';
    }

    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
    function escapeAttr(s){ return String(s||'').replace(/"/g, '&quot;'); }

    function renderProducts(){
      const wrap = document.getElementById('productList');
      wrap.innerHTML = '';
      const list = store.get(K_PRODUCTS, []);
      document.getElementById('prodCount').textContent = list.length + '개';

      if(list.length === 0){
        wrap.outerHTML = `<div id="productList" class="empty">관리자에서 상품을 추가하면 여기에 자동으로 나타납니다.</div>`;
        return;
      }

      list.forEach(it=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${escapeHtml(it.title)} <span class="pill">자동</span></h3>
          <p>${escapeHtml(it.desc || '')}</p>
          <p class="price">${formatPrice(it.price)}</p>
          <div>
            ${it.link ? `<a class="btn primary" href="${escapeAttr(it.link)}" target="_blank">구매하기</a>` : `<span class="subtle">링크 없음</span>`}
          </div>
        `;
        wrap.appendChild(card);
      });
    }

    function renderVideos(){
      const wrap = document.getElementById('videoList');
      wrap.innerHTML = '';
      const list = store.get(K_VIDEOS, []);
      document.getElementById('videoCount').textContent = list.length + '개';

      if(list.length === 0){
        wrap.outerHTML = `<div id="videoList" class="empty">관리자에서 영상을 추가하면 여기에 자동으로 나타납니다.</div>`;
        return;
      }

      list.forEach(it=>{
        const card = document.createElement('div');
        card.className = 'card';
        const url = (it.url||'').startsWith('https://www.youtube.com/embed/')
          ? it.url
          : ''; // 잘못된 URL은 임베드 생략
        card.innerHTML = `
          <h3>${escapeHtml(it.title)} ${it.category? `<span class="pill">${escapeHtml(it.category)}</span>`:''}</h3>
          <p>${escapeHtml(it.desc || '')}</p>
          ${url
            ? `<div class="video-embed" style="aspect-ratio:16/9;"><iframe src="${escapeAttr(url)}" allowfullscreen style="width:100%;height:100%;border:0;"></iframe></div>`
            : `<p class="subtle">임베드 URL이 아니어서 미리보기 없음<br><a href="${escapeAttr(it.url||'#')}" target="_blank">원본 열기</a></p>`
          }
        `;
        wrap.appendChild(card);
      });
    }

    function renderAll(){ renderProducts(); renderVideos(); }
    document.getElementById('refreshBtn').addEventListener('click', e => { e.preventDefault(); renderAll(); });

    // 초기 렌더
    renderAll();
  </script>
</body>
</html>
